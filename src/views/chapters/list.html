{{#*inline "child"}}
<div class="panel box-shadow-none content-header">
    <div class="panel-body">
        <div class="col-md-12">
            <h3 class="animated fadeInLeft">书籍章节</h3>
            <div class="row">
                <ol class="animated fadeInDown breadcrumb col-md-2 col-sm-12 col-xs-12">
                    <li><a href="{{base_url}}">首页</a></li>
                    <li class="active">章节列表</li>

                    <!--按钮-->
                    <span class="hidden-md hidden-lg pull-right" id="search-btn"
                        style="display: inline-block;cursor: pointer;">
                        搜索
                        <span class="caret"></span>
                    </span>
                </ol>
                <!--搜索内容-->
                <div class="col-md-10 col-sm-12 col-xs-12" id="search">
                    <ul class="">
                        <form method="get">
                            <li>
                                <label></label>
                                <input type="text" name="title" value="{{get.title}}" placeholder="章节标题"
                                    style="height:35px;width:100px">
                            </li>
                            <li>
                                <label>书名：</label>
                                <input type="text" name="book_name" value="{{get.book_name}}" placeholder="书名"
                                    style="height:35px;width:100px">
                            </li>
                            <li>
                                <label>作者：</label>
                                <input type="text" name="book_author" value="{{get.book_author}}" placeholder="作者"
                                    style="height:35px;width:100px">
                            </li>

                            <li>
                                <select name="finish" style="height:35px;width:110px">
                                    <option value="0">是否发布</option>
                                    <option value="1" {{#if (eq get.finish 1)}}selected{{/if}}>已发布</option>
                                    <option value="2" {{#if (eq get.finish 2)}}selected{{/if}}>未发布</option>
                                </select>
                            </li>

                            <li>
                                <input type="submit" class="btn btn-outline btn-success" value="搜索"
                                    style="padding-right: 20px; padding-left: 20px;padding-top:5px;padding-bottom: 5px;">
                            </li>
                            <li>
                                <a href="/book/chapters/list" class="btn btn-outline btn-warning"
                                    style="padding-right: 20px; padding-left: 20px;padding-top:5px;padding-bottom: 5px;">重置</a>
                            </li>
                        </form>
                    </ul>
                </div>

            </div>
        </div>
    </div>
</div>


<div class="col-md-12 top-20 padding-0">
    <div class="col-md-12">
        <div class="panel">
            <div class="panel-body">

                <!-- 警告(提示) start -->

                <!-- 警告(提示) end -->

                <div class="col-md-12 " style="padding-bottom:20px;">
                    <!-- <a href="javascript:history.back(-1);" class="right btn btn-gradient btn-default" style="margin-left:8px;" >后退</a> -->
                    <a href="{{base_url}}book/new" title="新增" class="right btn btn-gradient btn-info">新增书籍</a>
                    <h4 style="padding-left:10px;">列表<span style="font-size: 12px;"> (共{{list_len}}条)</span></h4>
                </div>

                <div class="responsive-table">
                    <form method="post" action="/book/delete" onsubmit="return checkboxDelete()"">
						<table class=" table table-striped table-bordered" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" class="icheck gou" name="checkbox1" />
                                </th>
                                <th>书籍名</th>
                                <th>章节标题</th>
                                <th>SEO关键字</th>
                                <th width="30">状态</th>
                                <th>阅读</th>
                                <th width="88">最后修改</th>

                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>

                            {{#if list}}
                            {{#each list}}
                            <tr>
                                <td>
                                    <input type="checkbox" class="icheck none" name="ids" value="{{id}}" />
                                </td>
                                <td>

                                    <b class="hidden-md hidden-lg">书籍名：</b>
                                    <p>《{{book_name}}》<span style="font-size: 8px;">{{author}}</span></p>
                                </td>
                                <td>
                                    <b class="hidden-md hidden-lg">章节标题：</b>{{title}}
                                </td>
                                <td>
                                    <b class="hidden-md hidden-lg">SEO关键字：</b>{{seo_keywords}}
                                </td>
                                <td>
                                    <b class="hidden-md hidden-lg">状态：</b>
                                    {{#if publish}}
                                    <span class="label label-info">已发布</span>
                                    {{else}}
                                    <span class="label label-success">未发布</span>
                                    {{/if}}
                                </td>
                                <td>
                                    <b class="hidden-md hidden-lg">阅读：</b>{{visit}}次
                                </td>
                                <td class="iso-time">
                                    {{last_time}}
                                </td>
                                <td>
                                    <input type="hidden" name="book_name_{{id}}" value="{{title}}">
                                    <a href="javascript:void(0)" class="text-info" data-toggle="modal"
                                        data-target="#myModal" onclick="toggleMenu({{id}})">
                                        <i class="fa"></i>查看正文
                                        <span class="text-muted"></span>
                                    </a>
                                    |

                                    |
                                    <br>
                                    <a href="/book/chapters/edit/{{id}}"><i class="fa fa-edit"></i> 修改
                                        <span class="text-muted"></span>
                                    </a> |
                                    <a style="color: red;" href="/book/chapters/delete/{{id}}"
                                        onclick="return confirm('是否要删除：{{name}}（ID:{{id}}）？？');">
                                        <i class="fa fa-trash-o"></i>删除
                                    </a>
                                </td>

                            </tr>
                            {{/each}}


                            <tr>
                                <td colspan="999">
                                    <div class="pull-right">
                                        <ul class="pagination pull-right">
                                            {{{pages}}}
                                        </ul>
                                    </div>

                                    <input type="checkbox" class="icheck pull-left gou" name="checkbox1" />
                                    <input type="hidden" name="del_ids" value="">
                                    <!-- <input type="button" class="btn btn-gradient btn-danger" value="删除" /> -->
                                    <input type="Submit" onclick="return confirm('是否删除选中的数据？？');"
                                        class="btn btn-gradient btn-danger" value="删除" />

                                    <!-- <input type="button" class=" btn btn-gradient btn-primary" value="修改" /> -->
                                    <a href="{{base_url}}book/new" title="新增"
                                        class="btn  btn-gradient btn-success">新增书籍</a>
                                    <!-- <input type="button" class="btn btn-gradient btn-default" value="返回" /> -->
                                    <input type="button" class="btn btn-gradient btn-default" value="后退"
                                        onclick="javascript:history.back(-1);" />

                                    <!-- <input type="button" class="btn btn-gradient btn-warning" value="警告" /> -->
                                    <!-- <input type="button" class="btn btn-gradient btn-info" value="通知" /> -->



                                </td>

                            </tr>
                            {{else}}
                            <tr>
                                <td colspan="200" style="text-align: center;">
                                    暂无数据!! 现在<a href="{{base_url}}book/new">新增书籍</a>数据
                                </td>
                            </tr>
                            {{/if}}

                        </tbody>
                        </table>
                    </form>
                </div>


            </div>
        </div>
    </div>
</div>


<!-- 模态框（Modal） 弹窗修改 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="接收表间的URl" class="cmxform" id="signupForm">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        提币审核
                    </h4>
                </div>

                <div class="modal-body">
                    <div class="col-md-12 panel-body" style="padding-bottom:30px;">
                        <div class="col-md-12">
                            <div id="description_content"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-default" data-dismiss="modal">取消
                    </button>
                    <!-- <input type="submit" class="btn btn-primary" value="确定" /> -->

                </div>
            </form>
        </div>
    </div>
</div>
<!-- 模态框（Modal）结束 -->


<link type="text/css" href="asset/css/bootstrap-datetimepicker.css" rel="stylesheet" media="screen">
<script type="text/javascript" src="asset/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="asset/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script src="asset/js/plugins/icheck.min.js"></script>

<script type="text/javascript">

    $(document).ready(function () {

        $('input').iCheck({
            checkboxClass: 'icheckbox_flat-red',
            radioClass: 'iradio_flat-red'
        });

        var width = $(window).width(); //获取屏幕宽度
        //搜索居右设置,大于990就添加一个类样式
        if (width > 990) {
            $('#search ul').addClass('pull-right');
        }
        $("#search-btn").click(function () {
            $('#search').toggle();
        });

        /*全选与反选*/
        var num = 0;
        $('.gou').next().each(function (i) {
            $(this).on('click', function () {

                if (num == 0) {
                    $('.icheck').prop('checked', true).parent().addClass('checked');
                    num += 1;
                } else {
                    $('.icheck').prop('checked', false).parent().removeClass('checked');
                    num = 0;
                }
            });
        });

        //（2024-06-10T05:32:33.708906）ISO 8601日期时间格式，分割显示
        $('tr td.iso-time').each(function () {
            var dateTimeStr = $(this).text().trim(); // 获取文本并去除空白字符
            var dateTimeParts = dateTimeStr.split('T'); // 分割日期和时间

            // 格式化日期和时间
            var dateStr = dateTimeParts[0]; // 日期部分
            var timeStr = dateTimeParts[1].split('.')[0]; // 时间部分，去掉毫秒

            // 显示格式化后的日期和时间
            // $(this).text('日期: ' + dateStr + ' 时间: ' + timeStr);
            $(this).html(dateStr + "<br>Time:" + timeStr);
        });

        /* 弹窗模组JS */
        $('#myModal').on('show.bs.modal', function () {
            // 在调用 show 方法后触发,执行一些动作...
            // alert('1.在调用 show 方法后触发。');
            // 取得动态值
            // var u_id = $("#coinTopUpWithdrawalID").val();
            // alert(u_id);

            // var addtr = '<tr><td colspan="200" style="text-align: center;">这是新增加的一行哦!!</td></tr>';
            // $(".modal-table-list").append(addtr);// 增加列表一行
        });

        $('#myModal').on('shown.bs.modal', function () {
            // 当模态框对用户可见时触发（将等待 CSS 过渡效果完成）,执行一些动作...
            // alert('2.当模态框对用户可见时触发（将等待 CSS 过渡效果完成）');
        });

        $('#myModal').on('hide.bs.modal', function () {
            // 当调用 hide 实例方法时触发，执行一些动作...
            // alert('3.当调用 hide 实例方法时触发 ');
        })

        $('#myModal').on('hidden.bs.modal', function () {
            // 当模态框完全对用户隐藏时触发,执行一些动作...
            // alert('4.当模态框完全对用户隐藏时触发');
        });

    });

    /* 多选删除onsubmit="return checkboxDelete()" */
    function checkboxDelete() {
        var arr = new Array();
        $("input:checkbox[name='ids']:checked").each(function () {
            arr.push($(this).val()); //向数组中添加元素  
        }); //获取界面复选框的所有值
        // alert(arr);
        arrType = arr.join(','); //把复选框的值以数组形式存放
        // alert(arrType);
        $("input[name='del_ids']").val(arrType);
    }

    /*弹窗前，请求章节正文内容 */
    function toggleMenu(id) {
        
        $("#description_content").html("");
        $.ajax({
            url: "/book/chapters/content/" + id,  //上传图片URL 
            // data: formData,
            cache: false,
            contentType: false,
            processData: false,
            type: 'GET',
            success: function (re) {
                if (re.status == 200) {
                    var book_description = re.data.content;
                    // 按行分割文本，并使用jQuery的each方法遍历每一行
                    $.each(book_description.split('\n'), function (index, line) {
                        // 过滤掉空行或只含空白的行
                        if (line.trim() !== '') {
                            // 包装每行文本为<p>标签，并添加到container中
                            $('#description_content').append('<p>' + line + '</p>');
                        }
                    });
                } else {
                    console.log('请求章节正文出错');
                    console.log(re);
                    alert('请求章节正文出错');
                }
            }
        });

        var book_name = $('input[name="book_name_' + id + '"]').val();

        // book_description_
        $("#myModalLabel").html("章节： " + book_name);
      
    }


</script>


{{/inline}}
{{> (lookup this "parent")}}